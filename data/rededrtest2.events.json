[{"date":"2024-12-31-14-10-15","do_dllinjection":true,"do_dllinjection_ucallstack":true,"do_etw":true,"do_etwti":true,"do_kernelcallback":true,"do_mplog":false,"func":"init","target":"malware","trace_id":41,"type":"meta","version":"0.3"},{"func":"process_create","id":1,"krn_pid":1436,"name":"\\Device\\HarddiskVolume2\\RedEdr\\data\\malware.exe","observe":1,"parent_name":"\\Device\\HarddiskVolume2\\RedEdr\\RedEdr.exe","pid":5024,"ppid":1436,"time":133801242158015218,"trace_id":41,"type":"kernel"},{"create":1,"func":"thread_create","id":2,"krn_pid":1436,"pid":5024,"threadid":4328,"time":133801242158015218,"trace_id":41,"type":"kernel"},{"func":"image_load","id":3,"image":"\\Device\\HarddiskVolume2\\RedEdr\\data\\malware.exe","krn_pid":5024,"pid":5024,"time":133801242158171461,"trace_id":41,"type":"kernel"},{"func":"image_load","id":4,"image":"\\Device\\HarddiskVolume2\\Windows\\System32\\ntdll.dll","krn_pid":5024,"pid":5024,"time":133801242158171461,"trace_id":41,"type":"kernel"},{"func":"image_load","id":5,"image":"\\Device\\HarddiskVolume2\\Windows\\System32\\kernel32.dll","krn_pid":5024,"pid":5024,"time":133801242158171461,"trace_id":41,"type":"kernel"},{"func":"image_load","id":6,"image":"\\Device\\HarddiskVolume2\\Windows\\System32\\KernelBase.dll","krn_pid":5024,"pid":5024,"time":133801242158171461,"trace_id":41,"type":"kernel"},{"func":"image_load","id":7,"image":"\\Device\\HarddiskVolume2\\Windows\\System32\\apphelp.dll","krn_pid":5024,"pid":5024,"time":133801242158327708,"trace_id":41,"type":"kernel"},{"func":"image_load","id":8,"image":"\\Device\\HarddiskVolume2\\Windows\\System32\\advapi32.dll","krn_pid":5024,"pid":5024,"time":133801242158327708,"trace_id":41,"type":"kernel"},{"func":"image_load","id":9,"image":"\\Device\\HarddiskVolume2\\Windows\\System32\\msvcrt.dll","krn_pid":5024,"pid":5024,"time":133801242158327708,"trace_id":41,"type":"kernel"},{"create":1,"func":"thread_create","id":10,"krn_pid":5024,"pid":5024,"threadid":5992,"time":133801242158327708,"trace_id":41,"type":"kernel"},{"func":"image_load","id":11,"image":"\\Device\\HarddiskVolume2\\Windows\\System32\\sechost.dll","krn_pid":5024,"pid":5024,"time":133801242158483962,"trace_id":41,"type":"kernel"},{"func":"image_load","id":12,"image":"\\Device\\HarddiskVolume2\\Windows\\System32\\rpcrt4.dll","krn_pid":5024,"pid":5024,"time":133801242158483962,"trace_id":41,"type":"kernel"},{"func":"image_load","id":13,"image":"\\Device\\HarddiskVolume2\\Windows\\System32\\bcrypt.dll","krn_pid":5024,"pid":5024,"time":133801242158483962,"trace_id":41,"type":"kernel"},{"func":"image_load","id":14,"image":"\\Device\\HarddiskVolume2\\Windows\\System32\\msvcp140d.dll","krn_pid":5024,"pid":5024,"time":133801242158483962,"trace_id":41,"type":"kernel"},{"func":"image_load","id":15,"image":"\\Device\\HarddiskVolume2\\Windows\\System32\\vcruntime140d.dll","krn_pid":5024,"pid":5024,"time":133801242158483962,"trace_id":41,"type":"kernel"},{"func":"image_load","id":16,"image":"\\Device\\HarddiskVolume2\\Windows\\System32\\vcruntime140_1d.dll","krn_pid":5024,"pid":5024,"time":133801242158483962,"trace_id":41,"type":"kernel"},{"create":1,"func":"thread_create","id":17,"krn_pid":5024,"pid":5024,"threadid":716,"time":133801242158483962,"trace_id":41,"type":"kernel"},{"func":"image_load","id":18,"image":"\\Device\\HarddiskVolume2\\Windows\\System32\\ucrtbased.dll","krn_pid":5024,"pid":5024,"time":133801242158483962,"trace_id":41,"type":"kernel"},{"func":"image_load","id":19,"image":"\\Device\\HarddiskVolume2\\RedEdr\\RedEdrDll.dll","krn_pid":5024,"pid":5024,"time":133801242158640219,"trace_id":41,"type":"kernel"},{"func":"image_load","id":20,"image":"\\Device\\HarddiskVolume2\\Windows\\System32\\dbghelp.dll","krn_pid":5024,"pid":5024,"time":133801242158640219,"trace_id":41,"type":"kernel"},{"func":"image_load","id":21,"image":"\\Device\\HarddiskVolume2\\Windows\\System32\\ucrtbase.dll","krn_pid":5024,"pid":5024,"time":133801242158640219,"trace_id":41,"type":"kernel"},{"func":"hooking_start","id":22,"pid":5024,"tid":4328,"trace_id":41,"type":"dll"},{"func":"hooking_finished","id":23,"pid":5024,"tid":4328,"trace_id":41,"type":"dll"},{"addr":1267840278528,"alloc_type":4096,"func":"NtAllocateVirtualMemory","handle":-1,"id":24,"pid":5024,"protect":"RW-","return":0,"size":8192,"size_req":8192,"tid":4328,"time":133801242158796446,"trace_id":41,"type":"dll","zero":0},{"addr":1267841499136,"alloc_type":12288,"func":"NtAllocateVirtualMemory","handle":-1,"id":25,"pid":5024,"protect":"RW-","return":0,"size":4096,"size_req":3,"tid":4328,"time":133801242158796446,"trace_id":41,"type":"dll","zero":0},{"func":"image_load","id":26,"image":"\\Device\\HarddiskVolume2\\Windows\\System32\\bcryptprimitives.dll","krn_pid":5024,"pid":5024,"time":133801242158796446,"trace_id":41,"type":"kernel"},{"addr":1267841499136,"callstack":[{"addr":140719110929628,"addr_info":"RedEdrDll.dll:.text","idx":0,"page_addr":140719110926336,"protect":"R-X","size":143360,"state":4172525256,"type":"IMAGE"},{"addr":140719110957985,"addr_info":"RedEdrDll.dll:.text","idx":1,"page_addr":140719110955008,"protect":"R-X","size":114688,"state":4172525256,"type":"IMAGE"},{"addr":140719652456182,"addr_info":"KERNELBASE.dll:.text","idx":2,"page_addr":140719652454400,"protect":"R-X","size":843776,"state":4172525256,"type":"IMAGE"},{"addr":140696690820198,"addr_info":"malware.exe:.text","idx":3,"page_addr":140696690819072,"protect":"R-X","size":376832,"state":4172525256,"type":"IMAGE"},{"addr":140696690822719,"addr_info":"malware.exe:.text","idx":4,"page_addr":140696690819072,"protect":"R-X","size":376832,"state":4172525256,"type":"IMAGE"},{"addr":140696691118393,"addr_info":"malware.exe:.text","idx":5,"page_addr":140696691118080,"protect":"R-X","size":77824,"state":4172525256,"type":"IMAGE"},{"addr":140696691118050,"addr_info":"malware.exe:.text","idx":6,"page_addr":140696691113984,"protect":"R-X","size":81920,"state":4172525256,"type":"IMAGE"},{"addr":140696691117726,"addr_info":"malware.exe:.text","idx":7,"page_addr":140696691113984,"protect":"R-X","size":81920,"state":4172525256,"type":"IMAGE"},{"addr":140696691118542,"addr_info":"malware.exe:.text","idx":8,"page_addr":140696691118080,"protect":"R-X","size":77824,"state":4172525256,"type":"IMAGE"}],"detections":["HIGH: NtProtectVirtualMemory with RWX at addr 1267841499136"],"func":"NtProtectVirtualMemory","handle":-1,"id":27,"pid":5024,"protect":"RWX","return":0,"size":4096,"tid":4328,"time":133801242158796446,"trace_id":41,"type":"dll"},{"commandline":"\"C:\\RedEdr\\data\\malware.exe\"","func":"peb","id":28,"image_base":140696689508352,"image_path":"C:\\RedEdr\\data\\malware.exe","is_debugged":0,"is_protected_process":0,"is_protected_process_light":0,"parent_pid":140698833651100,"time":133801242160202723,"trace_id":41,"type":"proces_query","working_dir":"C:\\Windows\\system32\\"},{"dlls":[{"addr":140696689508352,"name":"malware.exe","size":2097152},{"addr":140719693824000,"name":"ntdll.dll","size":2064384},{"addr":140719692709888,"name":"KERNEL32.DLL","size":794624},{"addr":140719652012032,"name":"KERNELBASE.dll","size":3137536},{"addr":140719606398976,"name":"apphelp.dll","size":606208},{"addr":140719689957376,"name":"ADVAPI32.dll","size":724992},{"addr":140719669641216,"name":"msvcrt.dll","size":647168},{"addr":140719668985856,"name":"sechost.dll","size":651264},{"addr":140719688384512,"name":"RPCRT4.dll","size":1191936},{"addr":140719657254912,"name":"bcrypt.dll","size":159744},{"addr":140719098626048,"name":"MSVCP140D.dll","size":925696},{"addr":140719593029632,"name":"VCRUNTIME140D.dll","size":188416},{"addr":140719577366528,"name":"VCRUNTIME140_1D.dll","size":61440},{"addr":140719096332288,"name":"ucrtbased.dll","size":2232320},{"addr":140719110619136,"name":"RedEdrDll.dll","size":618496},{"addr":140719404417024,"name":"dbghelp.dll","size":1982464},{"addr":140719657910272,"name":"ucrtbase.dll","size":1048576},{"addr":140719650439168,"name":"bcryptPrimitives.dll","size":532480}],"func":"loaded_dll","id":29,"pid":5024,"time":133801242160202723,"trace_id":41,"type":"process_query"},{"BaseAddress":"00000127313E0000","CallingProcessCreateTime":"133801242158123606","CallingProcessId":"5024","CallingProcessProtection":"(Unsupported type)\n","CallingProcessSectionSignatureLevel":"(Unsupported type)\n","CallingProcessSignatureLevel":"(Unsupported type)\n","CallingProcessStartKey":"3940649673949634","CallingThreadCreateTime":"133801242158123630","CallingThreadId":"4328","LastProtectionMask":"4","OriginalProcessCreateTime":"133801242158123606","OriginalProcessId":"5024","OriginalProcessProtection":"(Unsupported type)\n","OriginalProcessSectionSignatureLevel":"(Unsupported type)\n","OriginalProcessSignatureLevel":"(Unsupported type)\n","OriginalProcessStartKey":"3940649673949634","ProtectionMask":"64","RegionSize":"0000000000000003","TargetProcessCreateTime":"133801242158123606","TargetProcessId":"5024","TargetProcessProtection":"(Unsupported type)\n","TargetProcessSectionSignatureLevel":"(Unsupported type)\n","TargetProcessSignatureLevel":"(Unsupported type)\n","TargetProcessStartKey":"3940649673949634","event":"KERNEL_THREATINT_TASK_PROTECTVM","id":30,"opcode_id":0,"pid":5024,"provider_name":"f4e1897c-bb5d-5668-f1d8-040f4d8dd344","stack_trace":[{"addr":140719694470900,"addr_info":"ntdll.dll:.text"},{"addr":140719110957056,"addr_info":"RedEdrDll.dll:.text"},{"addr":140719652456182,"addr_info":"KERNELBASE.dll:.text"},{"addr":140696690820198,"addr_info":"malware.exe:.text"},{"addr":140696690822719,"addr_info":"malware.exe:.text"},{"addr":140696691118393,"addr_info":"malware.exe:.text"},{"addr":140696691118050,"addr_info":"malware.exe:.text"},{"addr":140696691117726,"addr_info":"malware.exe:.text"},{"addr":140696691118542,"addr_info":"malware.exe:.text"},{"addr":140719692804980,"addr_info":"KERNEL32.DLL:.text"},{"addr":140719694138513,"addr_info":"ntdll.dll:.text"}],"thread_id":4328,"time":133801242191071875,"trace_id":41,"type":"etw"},{"create":1,"func":"thread_create","id":31,"krn_pid":5024,"pid":5024,"threadid":3612,"time":133801242189890296,"trace_id":41,"type":"kernel"},{"argument":1267841499136,"callstack":[{"addr":140719110929628,"addr_info":"RedEdrDll.dll:.text","idx":0,"page_addr":140719110926336,"protect":"R-X","size":143360,"state":4172523720,"type":"IMAGE"},{"addr":140719110946620,"addr_info":"RedEdrDll.dll:.text","idx":1,"page_addr":140719110942720,"protect":"R-X","size":126976,"state":4172523720,"type":"IMAGE"},{"addr":140719652256687,"addr_info":"KERNELBASE.dll:.text","idx":2,"page_addr":140719652253696,"protect":"R-X","size":1044480,"state":4172523720,"type":"IMAGE"},{"addr":140719692822813,"addr_info":"KERNEL32.DLL:.text","idx":3,"page_addr":140719692820480,"protect":"R-X","size":421888,"state":4172523720,"type":"IMAGE"},{"addr":140696690820275,"addr_info":"malware.exe:.text","idx":4,"page_addr":140696690819072,"protect":"R-X","size":376832,"state":4172523720,"type":"IMAGE"},{"addr":140696690822719,"addr_info":"malware.exe:.text","idx":5,"page_addr":140696690819072,"protect":"R-X","size":376832,"state":4172523720,"type":"IMAGE"},{"addr":140696691118393,"addr_info":"malware.exe:.text","idx":6,"page_addr":140696691118080,"protect":"R-X","size":77824,"state":4172523720,"type":"IMAGE"},{"addr":140696691118050,"addr_info":"malware.exe:.text","idx":7,"page_addr":140696691113984,"protect":"R-X","size":81920,"state":4172523720,"type":"IMAGE"},{"addr":140696691117726,"addr_info":"malware.exe:.text","idx":8,"page_addr":140696691113984,"protect":"R-X","size":81920,"state":4172523720,"type":"IMAGE"}],"func":"NtCreateThreadEx","handle":-1,"id":32,"pid":5024,"start_routine":1267841499136,"thread_handle":264,"tid":4328,"time":133801242189890296,"trace_id":41,"type":"dll"},{"desired_access":2031619,"event_type":0,"func":"NtCreateEvent","id":33,"initial_state":0,"pid":5024,"tid":3612,"time":133801242190046501,"trace_id":41,"type":"dll"},{"desired_access":2031619,"event_type":0,"func":"NtCreateEvent","id":34,"initial_state":0,"pid":5024,"tid":3612,"time":133801242190046501,"trace_id":41,"type":"dll"},{"access_mask":983047,"alloc_attributes":134217728,"callstack":[{"addr":140719110929628,"addr_info":"RedEdrDll.dll:.text","idx":0,"page_addr":140719110926336,"protect":"R-X","size":143360,"state":4178549512,"type":"IMAGE"},{"addr":140719110943496,"addr_info":"RedEdrDll.dll:.text","idx":1,"page_addr":140719110942720,"protect":"R-X","size":126976,"state":4178549512,"type":"IMAGE"},{"addr":140719652243489,"addr_info":"KERNELBASE.dll:.text","idx":2,"page_addr":140719652241408,"protect":"R-X","size":1056768,"state":4178549512,"type":"IMAGE"},{"addr":140719652245056,"addr_info":"KERNELBASE.dll:.text","idx":3,"page_addr":140719652241408,"protect":"R-X","size":1056768,"state":4178549512,"type":"IMAGE"},{"addr":140719693175663,"addr_info":"KERNEL32.DLL:.text","idx":4,"page_addr":140719693172736,"protect":"R-X","size":69632,"state":4178549512,"type":"IMAGE"},{"addr":140719693175190,"addr_info":"KERNEL32.DLL:.text","idx":5,"page_addr":140719693172736,"protect":"R-X","size":69632,"state":4178549512,"type":"IMAGE"},{"addr":140719653273545,"addr_info":"KERNELBASE.dll:.text","idx":6,"page_addr":140719653269504,"protect":"R-X","size":28672,"state":4178549512,"type":"IMAGE"},{"addr":140719694501912,"addr_info":"ntdll.dll:.text","idx":7,"page_addr":140719694499840,"protect":"R-X","size":491520,"state":4178549512,"type":"IMAGE"},{"addr":140719694401094,"addr_info":"ntdll.dll:.text","idx":8,"page_addr":140719694397440,"protect":"R-X","size":593920,"state":4178549512,"type":"IMAGE"}],"file_handle":0,"func":"NtCreateSection","id":35,"max_size":81487980272,"page_protection":4,"pid":5024,"section_handle":284,"tid":3612,"time":133801242190046501,"trace_id":41,"type":"dll"},{"alloc_type":0,"base_address":0,"callstack":[{"addr":140719110929628,"addr_info":"RedEdrDll.dll:.text","idx":0,"page_addr":140719110926336,"protect":"R-X","size":143360,"state":4178549496,"type":"IMAGE"},{"addr":140719110953602,"addr_info":"RedEdrDll.dll:.text","idx":1,"page_addr":140719110950912,"protect":"R-X","size":118784,"state":4178549496,"type":"IMAGE"},{"addr":140719652454662,"addr_info":"KERNELBASE.dll:.text","idx":2,"page_addr":140719652454400,"protect":"R-X","size":843776,"state":4178549496,"type":"IMAGE"},{"addr":140719652454366,"addr_info":"KERNELBASE.dll:.text","idx":3,"page_addr":140719652450304,"protect":"R-X","size":847872,"state":4178549496,"type":"IMAGE"},{"addr":140719693175726,"addr_info":"KERNEL32.DLL:.text","idx":4,"page_addr":140719693172736,"protect":"R-X","size":69632,"state":4178549496,"type":"IMAGE"},{"addr":140719693175190,"addr_info":"KERNEL32.DLL:.text","idx":5,"page_addr":140719693172736,"protect":"R-X","size":69632,"state":4178549496,"type":"IMAGE"},{"addr":140719653273545,"addr_info":"KERNELBASE.dll:.text","idx":6,"page_addr":140719653269504,"protect":"R-X","size":28672,"state":4178549496,"type":"IMAGE"},{"addr":140719694501912,"addr_info":"ntdll.dll:.text","idx":7,"page_addr":140719694499840,"protect":"R-X","size":491520,"state":4178549496,"type":"IMAGE"},{"addr":140719694401094,"addr_info":"ntdll.dll:.text","idx":8,"page_addr":140719694397440,"protect":"R-X","size":593920,"state":4178549496,"type":"IMAGE"}],"func":"NtMapViewOfSection","handle":-1,"id":36,"inherit_disposition":1,"pid":5024,"protect":"RW-","section_handle":284,"section_offset":0,"size":0,"tid":3612,"time":133801242190359023,"trace_id":41,"type":"dll","view_size":0,"zero_bits":0},{"addr":1267841630208,"alloc_type":4096,"func":"NtAllocateVirtualMemory","handle":-1,"id":37,"pid":5024,"protect":"RW-","return":0,"size":4096,"size_req":12,"tid":3612,"time":133801242190671451,"trace_id":41,"type":"dll","zero":0},{"addr":1267841630208,"free_type":8000,"func":"NtFreeVirtualMemory","handle":-1,"id":38,"pid":5024,"return":0,"size":4096,"size_req":12,"tid":3612,"time":133801242191765216,"trace_id":41,"type":"dll"},{"create":0,"func":"thread_create","id":39,"krn_pid":5024,"pid":5024,"threadid":4328,"time":133801242196765211,"trace_id":41,"type":"kernel"},{"create":0,"func":"thread_create","id":40,"krn_pid":5024,"pid":5024,"threadid":4328,"time":133801242196765211,"trace_id":41,"type":"kernel"},{"create":0,"func":"thread_create","id":41,"krn_pid":5024,"pid":5024,"threadid":716,"time":133801242196765211,"trace_id":41,"type":"kernel"},{"create":0,"func":"thread_create","id":42,"krn_pid":5024,"pid":5024,"threadid":3612,"time":133801242196765211,"trace_id":41,"type":"kernel"}]